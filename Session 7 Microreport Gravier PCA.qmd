---
title: "Session 7 Microreport: Gravier dataset PCA"
format: html
editor: visual
---

## Session 2 Microreport: Gavier dataset PCA


#Group 17 members:

-   Meineche, Josefine Tvermoes (s233776)

-   Slidsborg, Carina (s236244)

-   Thuesen, Esben Rahbek (s223102)

-   Toldi, Eszter Vir√°g (s232970)

-   Tran, John Vinh Quang (s230339)


#Load packages
```{r}
library(tidyverse)
library(broom)
library(patchwork)
```


#Load gravier dataset 

We load the gravier dataset and extract x as tibble. This contains the gene expression values which are all numeric and can be used for PCA. We also create a tibble combining the gene expressions and the prognosis early_metastasis for later use.

```{r}
#| label: load data

data_dir <- "data/"
data_file <- "gravier.RData"
data_loc <- "https://github.com/ramhiser/datamicroarray/raw/master/data/"

if( !dir.exists(data_dir) ){
  dir.create(path = data_dir)
}
if( !file.exists(str_c(data_dir, data_file)) ){
  download.file(
    url = str_c(data_loc, data_file),
    destfile = str_c(data_dir, data_file))
}
load(file = str_c(data_dir, data_file))

gravier_x <- gravier$x |>
  as_tibble()

gravier_all <- gravier |> 
  bind_cols() |>
  as_tibble() |> 
  relocate(early_metastasis = y)
```


#PCA

```{r}

gravier_PCA <- gravier_x |> 
  select(where(is.numeric)) |>
  scale() |> 
  prcomp()

```

Selecting by is.numeric has retained all columns, as expected, and they have been centered around 0 and scaled to have a standard deviation of 1. PCA was performed.

#Plot PCA coordinates

```{r}

gravier_PCA |> 
  augment(gravier_all) |> 
  ggplot(aes(.fittedPC1, 
             .fittedPC2, 
             color = early_metastasis)
         ) + 
  geom_point(size = 1.5) +
  scale_color_manual(
    values = c(poor = "#D55E00", 
               good = "#0072B2")
    ) +
  theme_light()+
  labs(
    title = "Projection onto two first Principle Components",
    x = "PC1",
    y = "PC2",
    colour = "Prognosis")
  
```

